{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.data_source_adapter.js)\r\n * Version: 20.1.7\r\n * Build date: Tue Aug 25 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _callbacks = require(\"../../core/utils/callbacks\");\n\nvar _callbacks2 = _interopRequireDefault(_callbacks);\n\nvar _uiData_grid = require(\"../data_grid/ui.data_grid.core\");\n\nvar _uiData_grid2 = _interopRequireDefault(_uiData_grid);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array_store = require(\"../../data/array_store\");\n\nvar _array_store2 = _interopRequireDefault(_array_store);\n\nvar _array_utils = require(\"../../data/array_utils\");\n\nvar _array_utils2 = _interopRequireDefault(_array_utils);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _uiData_grid2.default.Controller.inherit(function () {\n  function cloneItems(items, groupCount) {\n    if (items) {\n      items = items.slice(0);\n\n      if (groupCount) {\n        for (var i = 0; i < items.length; i++) {\n          items[i] = (0, _extend.extend)({\n            key: items[i].key\n          }, items[i]);\n          items[i].items = cloneItems(items[i].items, groupCount - 1);\n        }\n      }\n    }\n\n    return items;\n  }\n\n  function calculateOperationTypes(loadOptions, lastLoadOptions, isFullReload) {\n    var operationTypes = {\n      reload: true,\n      fullReload: true\n    };\n\n    if (lastLoadOptions) {\n      operationTypes = {\n        sorting: !_uiData_grid2.default.equalSortParameters(loadOptions.sort, lastLoadOptions.sort),\n        grouping: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group, true),\n        groupExpanding: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group) || lastLoadOptions.groupExpand,\n        filtering: !_uiData_grid2.default.equalFilterParameters(loadOptions.filter, lastLoadOptions.filter),\n        pageIndex: loadOptions.pageIndex !== lastLoadOptions.pageIndex,\n        skip: loadOptions.skip !== lastLoadOptions.skip,\n        take: loadOptions.take !== lastLoadOptions.take,\n        fullReload: isFullReload\n      };\n      operationTypes.reload = isFullReload || operationTypes.sorting || operationTypes.grouping || operationTypes.filtering;\n      operationTypes.paging = operationTypes.pageIndex || operationTypes.take;\n    }\n\n    return operationTypes;\n  }\n\n  function executeTask(action, timeout) {\n    if (_type2.default.isDefined(timeout)) {\n      (0, _common.executeAsync)(action, timeout);\n    } else {\n      action();\n    }\n  }\n\n  function createEmptyPagesData() {\n    return {\n      pages: {}\n    };\n  }\n\n  function getPageDataFromCache(options) {\n    return options.cachedPagesData.pages[options.pageIndex];\n  }\n\n  function setPageDataToCache(options, data) {\n    var pageIndex = options.pageIndex;\n\n    if (void 0 !== pageIndex) {\n      options.cachedPagesData.pages[pageIndex] = data;\n    }\n  }\n\n  return {\n    init: function (dataSource, remoteOperations) {\n      var that = this;\n      that._dataSource = dataSource;\n      that._remoteOperations = remoteOperations || {};\n      that._isLastPage = !dataSource.isLastPage();\n      that._hasLastPage = false;\n      that._currentTotalCount = 0;\n      that._cachedPagesData = createEmptyPagesData();\n      that._lastOperationTypes = {};\n      that._eventsStrategy = dataSource._eventsStrategy;\n      that._skipCorrection = 0;\n      that._isLoadingAll = false;\n      that.changed = (0, _callbacks2.default)();\n      that.loadingChanged = (0, _callbacks2.default)();\n      that.loadError = (0, _callbacks2.default)();\n      that.customizeStoreLoadOptions = (0, _callbacks2.default)();\n      that.changing = (0, _callbacks2.default)();\n      that._dataChangedHandler = that._handleDataChanged.bind(that);\n      that._dataLoadingHandler = that._handleDataLoading.bind(that);\n      that._dataLoadedHandler = that._handleDataLoaded.bind(that);\n      that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\n      that._loadErrorHandler = that._handleLoadError.bind(that);\n      that._pushHandler = that._handlePush.bind(that);\n      that._changingHandler = that._handleChanging.bind(that);\n      dataSource.on(\"changed\", that._dataChangedHandler);\n      dataSource.on(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\n      dataSource.on(\"customizeLoadResult\", that._dataLoadedHandler);\n      dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\n      dataSource.on(\"loadError\", that._loadErrorHandler);\n      dataSource.on(\"changing\", that._changingHandler);\n      dataSource.store().on(\"push\", that._pushHandler);\n      (0, _iterator.each)(dataSource, function (memberName, member) {\n        if (!that[memberName] && _type2.default.isFunction(member)) {\n          that[memberName] = function () {\n            return this._dataSource[memberName].apply(this._dataSource, arguments);\n          };\n        }\n      });\n    },\n    remoteOperations: function () {\n      return this._remoteOperations;\n    },\n    dispose: function (isSharedDataSource) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var store = dataSource.store();\n      dataSource.off(\"changed\", that._dataChangedHandler);\n      dataSource.off(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\n      dataSource.off(\"customizeLoadResult\", that._dataLoadedHandler);\n      dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\n      dataSource.off(\"loadError\", that._loadErrorHandler);\n      dataSource.off(\"changing\", that._changingHandler);\n      store && store.off(\"push\", that._pushHandler);\n\n      if (!isSharedDataSource) {\n        dataSource.dispose();\n      }\n    },\n    refresh: function (options, operationTypes) {\n      var that = this;\n      var dataSource = that._dataSource;\n\n      if (operationTypes.reload) {\n        that.resetCurrentTotalCount();\n        that._isLastPage = !dataSource.paginate();\n        that._hasLastPage = that._isLastPage;\n      }\n    },\n    resetCurrentTotalCount: function () {\n      this._currentTotalCount = 0;\n      this._skipCorrection = 0;\n    },\n    resetCache: function () {\n      this._cachedStoreData = void 0;\n      this._cachedPagingData = void 0;\n    },\n    resetPagesCache: function () {\n      this._cachedPagesData = createEmptyPagesData();\n    },\n    _needClearStoreDataCache: function () {\n      var remoteOperations = this.remoteOperations();\n      var operationTypes = calculateOperationTypes(this._lastLoadOptions || {}, {});\n      var isLocalOperations = Object.keys(remoteOperations).every(function (operationName) {\n        return !operationTypes[operationName] || !remoteOperations[operationName];\n      });\n      return !isLocalOperations;\n    },\n    push: function (changes, fromStore) {\n      var store = this.store();\n\n      if (this._needClearStoreDataCache()) {\n        this._cachedStoreData = void 0;\n      }\n\n      this._cachedPagingData = void 0;\n      this.resetPagesCache(true);\n\n      if (this._cachedStoreData) {\n        _array_utils2.default.applyBatch(store, this._cachedStoreData, changes);\n      }\n\n      if (!fromStore) {\n        this._applyBatch(changes);\n      }\n    },\n    getDataIndexGetter: function () {\n      var _this = this;\n\n      if (!this._dataIndexGetter) {\n        var indexByKey;\n        var storeData;\n        var store = this.store();\n\n        this._dataIndexGetter = function (data) {\n          var isCacheUpdated = storeData && storeData !== _this._cachedStoreData;\n\n          if (!indexByKey || isCacheUpdated) {\n            storeData = _this._cachedStoreData || [];\n            indexByKey = {};\n\n            for (var i = 0; i < storeData.length; i++) {\n              indexByKey[(0, _common.getKeyHash)(store.keyOf(storeData[i]))] = i;\n            }\n          }\n\n          return indexByKey[(0, _common.getKeyHash)(store.keyOf(data))];\n        };\n      }\n\n      return this._dataIndexGetter;\n    },\n    _getKeyInfo: function () {\n      return this.store();\n    },\n    _applyBatch: function (changes) {\n      var _this2 = this;\n\n      var keyInfo = this._getKeyInfo();\n\n      var dataSource = this._dataSource;\n\n      var groupCount = _uiData_grid2.default.normalizeSortingInfo(this.group()).length;\n\n      changes = changes.filter(function (change) {\n        return !dataSource.paginate() || \"insert\" !== change.type || void 0 !== change.index;\n      });\n\n      var getItemCount = function () {\n        return groupCount ? _this2.itemsCount() : _this2._items.length;\n      };\n\n      var oldItemCount = getItemCount();\n\n      _array_utils2.default.applyBatch(keyInfo, this._items, changes, groupCount, true);\n\n      _array_utils2.default.applyBatch(keyInfo, dataSource.items(), changes, groupCount, true);\n\n      if (this._currentTotalCount > 0) {\n        this._skipCorrection += getItemCount() - oldItemCount;\n      }\n\n      changes.splice(0, changes.length);\n    },\n    _handlePush: function (changes) {\n      this.push(changes, true);\n    },\n    _handleChanging: function (e) {\n      this.changing.fire(e);\n\n      this._applyBatch(e.changes);\n    },\n    _needCleanCacheByOperation: function (operationType, remoteOperations) {\n      var operationTypesByOrder = [\"filtering\", \"sorting\", \"paging\"];\n      var operationTypeIndex = operationTypesByOrder.indexOf(operationType);\n      var currentOperationTypes = operationTypeIndex >= 0 ? operationTypesByOrder.slice(operationTypeIndex) : [operationType];\n      return currentOperationTypes.some(function (operationType) {\n        return remoteOperations[operationType];\n      });\n    },\n    _customizeRemoteOperations: function (options, operationTypes) {\n      var that = this;\n      var cachedStoreData = that._cachedStoreData;\n      var cachedPagingData = that._cachedPagingData;\n      var cachedPagesData = that._cachedPagesData;\n\n      if (options.storeLoadOptions.filter && !options.remoteOperations.filtering || options.storeLoadOptions.sort && !options.remoteOperations.sorting) {\n        options.remoteOperations = {\n          filtering: options.remoteOperations.filtering\n        };\n      }\n\n      if (operationTypes.fullReload) {\n        cachedStoreData = void 0;\n        cachedPagingData = void 0;\n        cachedPagesData = createEmptyPagesData();\n      } else {\n        if (operationTypes.reload) {\n          cachedPagingData = void 0;\n          cachedPagesData = createEmptyPagesData();\n        } else {\n          if (operationTypes.take || operationTypes.groupExpanding) {\n            cachedPagesData = createEmptyPagesData();\n          }\n        }\n\n        (0, _iterator.each)(operationTypes, function (operationType, value) {\n          if (value && that._needCleanCacheByOperation(operationType, options.remoteOperations)) {\n            cachedStoreData = void 0;\n            cachedPagingData = void 0;\n          }\n        });\n      }\n\n      if (cachedPagingData) {\n        options.remoteOperations.paging = false;\n      }\n\n      options.cachedStoreData = cachedStoreData;\n      options.cachedPagingData = cachedPagingData;\n      options.cachedPagesData = cachedPagesData;\n\n      if (!options.isCustomLoading) {\n        that._cachedStoreData = cachedStoreData;\n        that._cachedPagingData = cachedPagingData;\n        that._cachedPagesData = cachedPagesData;\n      }\n    },\n    _handleDataLoading: function (options) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var lastLoadOptions = that._lastLoadOptions;\n      that.customizeStoreLoadOptions.fire(options);\n      options.delay = this.option(\"loadingTimeout\");\n      options.originalStoreLoadOptions = options.storeLoadOptions;\n      options.remoteOperations = (0, _extend.extend)({}, this.remoteOperations());\n      var isFullReload = !that.isLoaded() && !that._isRefreshing;\n\n      if (that.option(\"integrationOptions.renderedOnServer\") && !that.isLoaded()) {\n        options.delay = void 0;\n      }\n\n      var loadOptions = (0, _extend.extend)({\n        pageIndex: that.pageIndex()\n      }, options.storeLoadOptions);\n      var operationTypes = calculateOperationTypes(loadOptions, lastLoadOptions, isFullReload);\n\n      that._customizeRemoteOperations(options, operationTypes);\n\n      if (!options.isCustomLoading) {\n        var isRefreshing = that._isRefreshing;\n        options.pageIndex = dataSource.pageIndex();\n        options.lastLoadOptions = loadOptions;\n        options.operationTypes = operationTypes;\n        that._loadingOperationTypes = operationTypes;\n        that._isRefreshing = true;\n        (0, _deferred.when)(isRefreshing || that._isRefreshed || that.refresh(options, operationTypes)).done(function () {\n          if (that._lastOperationId === options.operationId) {\n            that._isRefreshed = true;\n            that.load().always(function () {\n              that._isRefreshed = false;\n            });\n          }\n        }).fail(function () {\n          dataSource.cancel(options.operationId);\n        }).always(function () {\n          that._isRefreshing = false;\n        });\n        dataSource.cancel(that._lastOperationId);\n        that._lastOperationId = options.operationId;\n\n        if (that._isRefreshing) {\n          dataSource.cancel(that._lastOperationId);\n        }\n      }\n\n      this._handleDataLoadingCore(options);\n    },\n    _handleDataLoadingCore: function (options) {\n      var remoteOperations = options.remoteOperations;\n      options.loadOptions = {};\n      var cachedExtra = options.cachedPagesData.extra;\n      var localLoadOptionNames = {\n        filter: !remoteOperations.filtering,\n        sort: !remoteOperations.sorting,\n        group: !remoteOperations.grouping,\n        summary: !remoteOperations.summary,\n        skip: !remoteOperations.paging,\n        take: !remoteOperations.paging,\n        requireTotalCount: cachedExtra && \"totalCount\" in cachedExtra || !remoteOperations.paging\n      };\n      (0, _iterator.each)(options.storeLoadOptions, function (optionName, optionValue) {\n        if (localLoadOptionNames[optionName]) {\n          options.loadOptions[optionName] = optionValue;\n          delete options.storeLoadOptions[optionName];\n        }\n      });\n\n      if (cachedExtra) {\n        options.extra = cachedExtra;\n      }\n\n      options.data = getPageDataFromCache(options) || options.cachedStoreData;\n    },\n    _handleDataLoaded: function (options) {\n      var _this3 = this;\n\n      var loadOptions = options.loadOptions;\n      var localPaging = options.remoteOperations && !options.remoteOperations.paging;\n      var cachedPagesData = options.cachedPagesData;\n      var storeLoadOptions = options.storeLoadOptions;\n      var needCache = false !== this.option(\"cacheEnabled\") && storeLoadOptions;\n      var needPageCache = needCache && !options.isCustomLoading && cachedPagesData && (!localPaging || storeLoadOptions.group) && !this.option(\"legacyRendering\");\n      var needPagingCache = needCache && localPaging;\n      var needStoreCache = needPagingCache && !options.isCustomLoading;\n\n      if (!loadOptions) {\n        this._dataSource.cancel(options.operationId);\n\n        return;\n      }\n\n      if (options.lastLoadOptions) {\n        this._lastLoadOptions = options.lastLoadOptions;\n        Object.keys(options.operationTypes).forEach(function (operationType) {\n          _this3._lastOperationTypes[operationType] = _this3._lastOperationTypes[operationType] || options.operationTypes[operationType];\n        });\n      }\n\n      if (localPaging) {\n        options.skip = loadOptions.skip;\n        options.take = loadOptions.take;\n        delete loadOptions.skip;\n        delete loadOptions.take;\n      }\n\n      if (loadOptions.group) {\n        loadOptions.group = options.group || loadOptions.group;\n      }\n\n      var groupCount = _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group || loadOptions.group).length;\n\n      if (!needPageCache || !getPageDataFromCache(options)) {\n        if (needPagingCache && options.cachedPagingData) {\n          options.data = cloneItems(options.cachedPagingData, groupCount);\n        } else {\n          if (needStoreCache) {\n            if (!this._cachedStoreData) {\n              this._cachedStoreData = cloneItems(options.data, _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group).length);\n            } else {\n              if (options.mergeStoreLoadData) {\n                options.data = this._cachedStoreData = this._cachedStoreData.concat(options.data);\n              }\n            }\n          }\n\n          new _array_store2.default(options.data).load(loadOptions).done(function (data) {\n            options.data = data;\n\n            if (needStoreCache) {\n              _this3._cachedPagingData = cloneItems(options.data, groupCount);\n            }\n          }).fail(function (error) {\n            options.data = new _deferred.Deferred().reject(error);\n          });\n        }\n\n        if (loadOptions.requireTotalCount && localPaging) {\n          options.extra = _type2.default.isPlainObject(options.extra) ? options.extra : {};\n          options.extra.totalCount = options.data.length;\n        }\n\n        if (options.extra && options.extra.totalCount >= 0 && (false === storeLoadOptions.requireTotalCount || false === loadOptions.requireTotalCount)) {\n          options.extra.totalCount = -1;\n        }\n\n        this._handleDataLoadedCore(options);\n\n        if (needPageCache) {\n          cachedPagesData.extra = cachedPagesData.extra || (0, _extend.extend)({}, options.extra);\n          (0, _deferred.when)(options.data).done(function (data) {\n            setPageDataToCache(options, cloneItems(data, groupCount));\n          });\n        }\n      }\n\n      options.storeLoadOptions = options.originalStoreLoadOptions;\n    },\n    _handleDataLoadedCore: function (options) {\n      if (options.remoteOperations && !options.remoteOperations.paging && Array.isArray(options.data)) {\n        if (void 0 !== options.skip) {\n          options.data = options.data.slice(options.skip);\n        }\n\n        if (void 0 !== options.take) {\n          options.data = options.data.slice(0, options.take);\n        }\n      }\n    },\n    _handleLoadingChanged: function (isLoading) {\n      this.loadingChanged.fire(isLoading);\n    },\n    _handleLoadError: function (error) {\n      this.loadError.fire(error);\n      this.changed.fire({\n        changeType: \"loadError\",\n        error: error\n      });\n    },\n    _handleDataChanged: function (args) {\n      var that = this;\n      var currentTotalCount;\n      var dataSource = that._dataSource;\n      var isLoading = false;\n      var itemsCount = that.itemsCount();\n      that._isLastPage = !itemsCount || !that.pageSize() || itemsCount < that.pageSize();\n\n      if (that._isLastPage) {\n        that._hasLastPage = true;\n      }\n\n      if (dataSource.totalCount() >= 0) {\n        if (dataSource.pageIndex() >= that.pageCount()) {\n          dataSource.pageIndex(that.pageCount() - 1);\n          that.pageIndex(dataSource.pageIndex());\n          that.resetPagesCache();\n          dataSource.load();\n          isLoading = true;\n        }\n      } else {\n        currentTotalCount = dataSource.pageIndex() * that.pageSize() + itemsCount;\n        that._currentTotalCount = Math.max(that._currentTotalCount, currentTotalCount);\n\n        if (0 === itemsCount && dataSource.pageIndex() >= that.pageCount()) {\n          dataSource.pageIndex(that.pageCount() - 1);\n\n          if (\"infinite\" !== that.option(\"scrolling.mode\")) {\n            dataSource.load();\n            isLoading = true;\n          }\n        }\n      }\n\n      if (!isLoading) {\n        that._operationTypes = that._lastOperationTypes;\n        that._lastOperationTypes = {};\n        that.component._optionCache = {};\n        that.changed.fire(args);\n        that.component._optionCache = void 0;\n      }\n    },\n    _scheduleCustomLoadCallbacks: function (deferred) {\n      var that = this;\n      that._isCustomLoading = true;\n      deferred.always(function () {\n        that._isCustomLoading = false;\n      });\n    },\n    loadingOperationTypes: function () {\n      return this._loadingOperationTypes;\n    },\n    operationTypes: function () {\n      return this._operationTypes;\n    },\n    lastLoadOptions: function () {\n      return this._lastLoadOptions || {};\n    },\n    isLastPage: function () {\n      return this._isLastPage;\n    },\n    totalCount: function () {\n      return parseInt(this._currentTotalCount + this._skipCorrection || this._dataSource.totalCount());\n    },\n    itemsCount: function () {\n      return this._dataSource.items().length;\n    },\n    totalItemsCount: function () {\n      return this.totalCount();\n    },\n    pageSize: function () {\n      var dataSource = this._dataSource;\n\n      if (!arguments.length && !dataSource.paginate()) {\n        return 0;\n      }\n\n      return dataSource.pageSize.apply(dataSource, arguments);\n    },\n    pageCount: function () {\n      var that = this;\n\n      var count = that.totalItemsCount() - that._skipCorrection;\n\n      var pageSize = that.pageSize();\n\n      if (pageSize && count > 0) {\n        return Math.max(1, Math.ceil(count / pageSize));\n      }\n\n      return 1;\n    },\n    hasKnownLastPage: function () {\n      return this._hasLastPage || this._dataSource.totalCount() >= 0;\n    },\n    loadFromStore: function (loadOptions, store) {\n      var dataSource = this._dataSource;\n      var d = new _deferred.Deferred();\n\n      if (!dataSource) {\n        return;\n      }\n\n      store = store || dataSource.store();\n      store.load(loadOptions).done(function (data, extra) {\n        if (data && !Array.isArray(data) && Array.isArray(data.data)) {\n          extra = data;\n          data = data.data;\n        }\n\n        d.resolve(data, extra);\n      }).fail(d.reject);\n      return d;\n    },\n    isCustomLoading: function () {\n      return !!this._isCustomLoading;\n    },\n    load: function (options) {\n      var _this4 = this;\n\n      var that = this;\n      var dataSource = that._dataSource;\n      var d = new _deferred.Deferred();\n\n      if (options) {\n        var store = dataSource.store();\n        var dataSourceLoadOptions = dataSource.loadOptions();\n        var loadResult = {\n          storeLoadOptions: options,\n          isCustomLoading: true\n        };\n        (0, _iterator.each)(store._customLoadOptions() || [], function (_, optionName) {\n          if (!(optionName in loadResult.storeLoadOptions)) {\n            loadResult.storeLoadOptions[optionName] = dataSourceLoadOptions[optionName];\n          }\n        });\n        this._isLoadingAll = options.isLoadingAll;\n\n        that._scheduleCustomLoadCallbacks(d);\n\n        dataSource._scheduleLoadCallbacks(d);\n\n        that._handleDataLoading(loadResult);\n\n        executeTask(function () {\n          if (!dataSource.store()) {\n            return d.reject(\"canceled\");\n          }\n\n          (0, _deferred.when)(loadResult.data || that.loadFromStore(loadResult.storeLoadOptions)).done(function (data, extra) {\n            loadResult.data = data;\n            loadResult.extra = extra || {};\n\n            that._handleDataLoaded(loadResult);\n\n            if (options.requireTotalCount && void 0 === loadResult.extra.totalCount) {\n              loadResult.extra.totalCount = store.totalCount(loadResult.storeLoadOptions);\n            }\n\n            (0, _deferred.when)(loadResult.data, loadResult.extra.totalCount).done(function (data, totalCount) {\n              loadResult.extra.totalCount = totalCount;\n              d.resolve(data, loadResult.extra);\n            }).fail(d.reject);\n          }).fail(d.reject);\n        }, that.option(\"loadingTimeout\"));\n        return d.fail(function () {\n          that._eventsStrategy.fireEvent(\"loadError\", arguments);\n        }).always(function () {\n          _this4._isLoadingAll = false;\n        }).promise();\n      } else {\n        return dataSource.load();\n      }\n    },\n    reload: function (full) {\n      return full ? this._dataSource.reload() : this._dataSource.load();\n    },\n    getCachedStoreData: function () {\n      return this._cachedStoreData;\n    }\n  };\n}());","map":{"version":3,"sources":["C:/Users/ASUS/Desktop/ticketSystem/frontend/node_modules/devextreme/ui/grid_core/ui.grid_core.data_source_adapter.js"],"names":["_callbacks","require","_callbacks2","_interopRequireDefault","_uiData_grid","_uiData_grid2","_common","_type","_type2","_iterator","_extend","_array_store","_array_store2","_array_utils","_array_utils2","_deferred","obj","__esModule","module","exports","default","Controller","inherit","cloneItems","items","groupCount","slice","i","length","extend","key","calculateOperationTypes","loadOptions","lastLoadOptions","isFullReload","operationTypes","reload","fullReload","sorting","equalSortParameters","sort","grouping","group","groupExpanding","groupExpand","filtering","equalFilterParameters","filter","pageIndex","skip","take","paging","executeTask","action","timeout","isDefined","executeAsync","createEmptyPagesData","pages","getPageDataFromCache","options","cachedPagesData","setPageDataToCache","data","init","dataSource","remoteOperations","that","_dataSource","_remoteOperations","_isLastPage","isLastPage","_hasLastPage","_currentTotalCount","_cachedPagesData","_lastOperationTypes","_eventsStrategy","_skipCorrection","_isLoadingAll","changed","loadingChanged","loadError","customizeStoreLoadOptions","changing","_dataChangedHandler","_handleDataChanged","bind","_dataLoadingHandler","_handleDataLoading","_dataLoadedHandler","_handleDataLoaded","_loadingChangedHandler","_handleLoadingChanged","_loadErrorHandler","_handleLoadError","_pushHandler","_handlePush","_changingHandler","_handleChanging","on","store","each","memberName","member","isFunction","apply","arguments","dispose","isSharedDataSource","off","refresh","resetCurrentTotalCount","paginate","resetCache","_cachedStoreData","_cachedPagingData","resetPagesCache","_needClearStoreDataCache","_lastLoadOptions","isLocalOperations","Object","keys","every","operationName","push","changes","fromStore","applyBatch","_applyBatch","getDataIndexGetter","_this","_dataIndexGetter","indexByKey","storeData","isCacheUpdated","getKeyHash","keyOf","_getKeyInfo","_this2","keyInfo","normalizeSortingInfo","change","type","index","getItemCount","itemsCount","_items","oldItemCount","splice","e","fire","_needCleanCacheByOperation","operationType","operationTypesByOrder","operationTypeIndex","indexOf","currentOperationTypes","some","_customizeRemoteOperations","cachedStoreData","cachedPagingData","storeLoadOptions","value","isCustomLoading","delay","option","originalStoreLoadOptions","isLoaded","_isRefreshing","isRefreshing","_loadingOperationTypes","when","_isRefreshed","done","_lastOperationId","operationId","load","always","fail","cancel","_handleDataLoadingCore","cachedExtra","extra","localLoadOptionNames","summary","requireTotalCount","optionName","optionValue","_this3","localPaging","needCache","needPageCache","needPagingCache","needStoreCache","forEach","mergeStoreLoadData","concat","error","Deferred","reject","isPlainObject","totalCount","_handleDataLoadedCore","Array","isArray","isLoading","changeType","args","currentTotalCount","pageSize","pageCount","Math","max","_operationTypes","component","_optionCache","_scheduleCustomLoadCallbacks","deferred","_isCustomLoading","loadingOperationTypes","parseInt","totalItemsCount","count","ceil","hasKnownLastPage","loadFromStore","d","resolve","_this4","dataSourceLoadOptions","loadResult","_customLoadOptions","_","isLoadingAll","_scheduleLoadCallbacks","fireEvent","promise","full","getCachedStoreData"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.data_source_adapter.js)\r\n * Version: 20.1.7\r\n * Build date: Tue Aug 25 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _callbacks = require(\"../../core/utils/callbacks\");\r\nvar _callbacks2 = _interopRequireDefault(_callbacks);\r\nvar _uiData_grid = require(\"../data_grid/ui.data_grid.core\");\r\nvar _uiData_grid2 = _interopRequireDefault(_uiData_grid);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array_store = require(\"../../data/array_store\");\r\nvar _array_store2 = _interopRequireDefault(_array_store);\r\nvar _array_utils = require(\"../../data/array_utils\");\r\nvar _array_utils2 = _interopRequireDefault(_array_utils);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nmodule.exports = _uiData_grid2.default.Controller.inherit(function() {\r\n    function cloneItems(items, groupCount) {\r\n        if (items) {\r\n            items = items.slice(0);\r\n            if (groupCount) {\r\n                for (var i = 0; i < items.length; i++) {\r\n                    items[i] = (0, _extend.extend)({\r\n                        key: items[i].key\r\n                    }, items[i]);\r\n                    items[i].items = cloneItems(items[i].items, groupCount - 1)\r\n                }\r\n            }\r\n        }\r\n        return items\r\n    }\r\n\r\n    function calculateOperationTypes(loadOptions, lastLoadOptions, isFullReload) {\r\n        var operationTypes = {\r\n            reload: true,\r\n            fullReload: true\r\n        };\r\n        if (lastLoadOptions) {\r\n            operationTypes = {\r\n                sorting: !_uiData_grid2.default.equalSortParameters(loadOptions.sort, lastLoadOptions.sort),\r\n                grouping: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group, true),\r\n                groupExpanding: !_uiData_grid2.default.equalSortParameters(loadOptions.group, lastLoadOptions.group) || lastLoadOptions.groupExpand,\r\n                filtering: !_uiData_grid2.default.equalFilterParameters(loadOptions.filter, lastLoadOptions.filter),\r\n                pageIndex: loadOptions.pageIndex !== lastLoadOptions.pageIndex,\r\n                skip: loadOptions.skip !== lastLoadOptions.skip,\r\n                take: loadOptions.take !== lastLoadOptions.take,\r\n                fullReload: isFullReload\r\n            };\r\n            operationTypes.reload = isFullReload || operationTypes.sorting || operationTypes.grouping || operationTypes.filtering;\r\n            operationTypes.paging = operationTypes.pageIndex || operationTypes.take\r\n        }\r\n        return operationTypes\r\n    }\r\n\r\n    function executeTask(action, timeout) {\r\n        if (_type2.default.isDefined(timeout)) {\r\n            (0, _common.executeAsync)(action, timeout)\r\n        } else {\r\n            action()\r\n        }\r\n    }\r\n\r\n    function createEmptyPagesData() {\r\n        return {\r\n            pages: {}\r\n        }\r\n    }\r\n\r\n    function getPageDataFromCache(options) {\r\n        return options.cachedPagesData.pages[options.pageIndex]\r\n    }\r\n\r\n    function setPageDataToCache(options, data) {\r\n        var pageIndex = options.pageIndex;\r\n        if (void 0 !== pageIndex) {\r\n            options.cachedPagesData.pages[pageIndex] = data\r\n        }\r\n    }\r\n    return {\r\n        init: function(dataSource, remoteOperations) {\r\n            var that = this;\r\n            that._dataSource = dataSource;\r\n            that._remoteOperations = remoteOperations || {};\r\n            that._isLastPage = !dataSource.isLastPage();\r\n            that._hasLastPage = false;\r\n            that._currentTotalCount = 0;\r\n            that._cachedPagesData = createEmptyPagesData();\r\n            that._lastOperationTypes = {};\r\n            that._eventsStrategy = dataSource._eventsStrategy;\r\n            that._skipCorrection = 0;\r\n            that._isLoadingAll = false;\r\n            that.changed = (0, _callbacks2.default)();\r\n            that.loadingChanged = (0, _callbacks2.default)();\r\n            that.loadError = (0, _callbacks2.default)();\r\n            that.customizeStoreLoadOptions = (0, _callbacks2.default)();\r\n            that.changing = (0, _callbacks2.default)();\r\n            that._dataChangedHandler = that._handleDataChanged.bind(that);\r\n            that._dataLoadingHandler = that._handleDataLoading.bind(that);\r\n            that._dataLoadedHandler = that._handleDataLoaded.bind(that);\r\n            that._loadingChangedHandler = that._handleLoadingChanged.bind(that);\r\n            that._loadErrorHandler = that._handleLoadError.bind(that);\r\n            that._pushHandler = that._handlePush.bind(that);\r\n            that._changingHandler = that._handleChanging.bind(that);\r\n            dataSource.on(\"changed\", that._dataChangedHandler);\r\n            dataSource.on(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\r\n            dataSource.on(\"customizeLoadResult\", that._dataLoadedHandler);\r\n            dataSource.on(\"loadingChanged\", that._loadingChangedHandler);\r\n            dataSource.on(\"loadError\", that._loadErrorHandler);\r\n            dataSource.on(\"changing\", that._changingHandler);\r\n            dataSource.store().on(\"push\", that._pushHandler);\r\n            (0, _iterator.each)(dataSource, function(memberName, member) {\r\n                if (!that[memberName] && _type2.default.isFunction(member)) {\r\n                    that[memberName] = function() {\r\n                        return this._dataSource[memberName].apply(this._dataSource, arguments)\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        remoteOperations: function() {\r\n            return this._remoteOperations\r\n        },\r\n        dispose: function(isSharedDataSource) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var store = dataSource.store();\r\n            dataSource.off(\"changed\", that._dataChangedHandler);\r\n            dataSource.off(\"customizeStoreLoadOptions\", that._dataLoadingHandler);\r\n            dataSource.off(\"customizeLoadResult\", that._dataLoadedHandler);\r\n            dataSource.off(\"loadingChanged\", that._loadingChangedHandler);\r\n            dataSource.off(\"loadError\", that._loadErrorHandler);\r\n            dataSource.off(\"changing\", that._changingHandler);\r\n            store && store.off(\"push\", that._pushHandler);\r\n            if (!isSharedDataSource) {\r\n                dataSource.dispose()\r\n            }\r\n        },\r\n        refresh: function(options, operationTypes) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            if (operationTypes.reload) {\r\n                that.resetCurrentTotalCount();\r\n                that._isLastPage = !dataSource.paginate();\r\n                that._hasLastPage = that._isLastPage\r\n            }\r\n        },\r\n        resetCurrentTotalCount: function() {\r\n            this._currentTotalCount = 0;\r\n            this._skipCorrection = 0\r\n        },\r\n        resetCache: function() {\r\n            this._cachedStoreData = void 0;\r\n            this._cachedPagingData = void 0\r\n        },\r\n        resetPagesCache: function() {\r\n            this._cachedPagesData = createEmptyPagesData()\r\n        },\r\n        _needClearStoreDataCache: function() {\r\n            var remoteOperations = this.remoteOperations();\r\n            var operationTypes = calculateOperationTypes(this._lastLoadOptions || {}, {});\r\n            var isLocalOperations = Object.keys(remoteOperations).every(function(operationName) {\r\n                return !operationTypes[operationName] || !remoteOperations[operationName]\r\n            });\r\n            return !isLocalOperations\r\n        },\r\n        push: function(changes, fromStore) {\r\n            var store = this.store();\r\n            if (this._needClearStoreDataCache()) {\r\n                this._cachedStoreData = void 0\r\n            }\r\n            this._cachedPagingData = void 0;\r\n            this.resetPagesCache(true);\r\n            if (this._cachedStoreData) {\r\n                _array_utils2.default.applyBatch(store, this._cachedStoreData, changes)\r\n            }\r\n            if (!fromStore) {\r\n                this._applyBatch(changes)\r\n            }\r\n        },\r\n        getDataIndexGetter: function() {\r\n            var _this = this;\r\n            if (!this._dataIndexGetter) {\r\n                var indexByKey;\r\n                var storeData;\r\n                var store = this.store();\r\n                this._dataIndexGetter = function(data) {\r\n                    var isCacheUpdated = storeData && storeData !== _this._cachedStoreData;\r\n                    if (!indexByKey || isCacheUpdated) {\r\n                        storeData = _this._cachedStoreData || [];\r\n                        indexByKey = {};\r\n                        for (var i = 0; i < storeData.length; i++) {\r\n                            indexByKey[(0, _common.getKeyHash)(store.keyOf(storeData[i]))] = i\r\n                        }\r\n                    }\r\n                    return indexByKey[(0, _common.getKeyHash)(store.keyOf(data))]\r\n                }\r\n            }\r\n            return this._dataIndexGetter\r\n        },\r\n        _getKeyInfo: function() {\r\n            return this.store()\r\n        },\r\n        _applyBatch: function(changes) {\r\n            var _this2 = this;\r\n            var keyInfo = this._getKeyInfo();\r\n            var dataSource = this._dataSource;\r\n            var groupCount = _uiData_grid2.default.normalizeSortingInfo(this.group()).length;\r\n            changes = changes.filter(function(change) {\r\n                return !dataSource.paginate() || \"insert\" !== change.type || void 0 !== change.index\r\n            });\r\n            var getItemCount = function() {\r\n                return groupCount ? _this2.itemsCount() : _this2._items.length\r\n            };\r\n            var oldItemCount = getItemCount();\r\n            _array_utils2.default.applyBatch(keyInfo, this._items, changes, groupCount, true);\r\n            _array_utils2.default.applyBatch(keyInfo, dataSource.items(), changes, groupCount, true);\r\n            if (this._currentTotalCount > 0) {\r\n                this._skipCorrection += getItemCount() - oldItemCount\r\n            }\r\n            changes.splice(0, changes.length)\r\n        },\r\n        _handlePush: function(changes) {\r\n            this.push(changes, true)\r\n        },\r\n        _handleChanging: function(e) {\r\n            this.changing.fire(e);\r\n            this._applyBatch(e.changes)\r\n        },\r\n        _needCleanCacheByOperation: function(operationType, remoteOperations) {\r\n            var operationTypesByOrder = [\"filtering\", \"sorting\", \"paging\"];\r\n            var operationTypeIndex = operationTypesByOrder.indexOf(operationType);\r\n            var currentOperationTypes = operationTypeIndex >= 0 ? operationTypesByOrder.slice(operationTypeIndex) : [operationType];\r\n            return currentOperationTypes.some(function(operationType) {\r\n                return remoteOperations[operationType]\r\n            })\r\n        },\r\n        _customizeRemoteOperations: function(options, operationTypes) {\r\n            var that = this;\r\n            var cachedStoreData = that._cachedStoreData;\r\n            var cachedPagingData = that._cachedPagingData;\r\n            var cachedPagesData = that._cachedPagesData;\r\n            if (options.storeLoadOptions.filter && !options.remoteOperations.filtering || options.storeLoadOptions.sort && !options.remoteOperations.sorting) {\r\n                options.remoteOperations = {\r\n                    filtering: options.remoteOperations.filtering\r\n                }\r\n            }\r\n            if (operationTypes.fullReload) {\r\n                cachedStoreData = void 0;\r\n                cachedPagingData = void 0;\r\n                cachedPagesData = createEmptyPagesData()\r\n            } else {\r\n                if (operationTypes.reload) {\r\n                    cachedPagingData = void 0;\r\n                    cachedPagesData = createEmptyPagesData()\r\n                } else {\r\n                    if (operationTypes.take || operationTypes.groupExpanding) {\r\n                        cachedPagesData = createEmptyPagesData()\r\n                    }\r\n                }(0, _iterator.each)(operationTypes, function(operationType, value) {\r\n                    if (value && that._needCleanCacheByOperation(operationType, options.remoteOperations)) {\r\n                        cachedStoreData = void 0;\r\n                        cachedPagingData = void 0\r\n                    }\r\n                })\r\n            }\r\n            if (cachedPagingData) {\r\n                options.remoteOperations.paging = false\r\n            }\r\n            options.cachedStoreData = cachedStoreData;\r\n            options.cachedPagingData = cachedPagingData;\r\n            options.cachedPagesData = cachedPagesData;\r\n            if (!options.isCustomLoading) {\r\n                that._cachedStoreData = cachedStoreData;\r\n                that._cachedPagingData = cachedPagingData;\r\n                that._cachedPagesData = cachedPagesData\r\n            }\r\n        },\r\n        _handleDataLoading: function(options) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var lastLoadOptions = that._lastLoadOptions;\r\n            that.customizeStoreLoadOptions.fire(options);\r\n            options.delay = this.option(\"loadingTimeout\");\r\n            options.originalStoreLoadOptions = options.storeLoadOptions;\r\n            options.remoteOperations = (0, _extend.extend)({}, this.remoteOperations());\r\n            var isFullReload = !that.isLoaded() && !that._isRefreshing;\r\n            if (that.option(\"integrationOptions.renderedOnServer\") && !that.isLoaded()) {\r\n                options.delay = void 0\r\n            }\r\n            var loadOptions = (0, _extend.extend)({\r\n                pageIndex: that.pageIndex()\r\n            }, options.storeLoadOptions);\r\n            var operationTypes = calculateOperationTypes(loadOptions, lastLoadOptions, isFullReload);\r\n            that._customizeRemoteOperations(options, operationTypes);\r\n            if (!options.isCustomLoading) {\r\n                var isRefreshing = that._isRefreshing;\r\n                options.pageIndex = dataSource.pageIndex();\r\n                options.lastLoadOptions = loadOptions;\r\n                options.operationTypes = operationTypes;\r\n                that._loadingOperationTypes = operationTypes;\r\n                that._isRefreshing = true;\r\n                (0, _deferred.when)(isRefreshing || that._isRefreshed || that.refresh(options, operationTypes)).done(function() {\r\n                    if (that._lastOperationId === options.operationId) {\r\n                        that._isRefreshed = true;\r\n                        that.load().always(function() {\r\n                            that._isRefreshed = false\r\n                        })\r\n                    }\r\n                }).fail(function() {\r\n                    dataSource.cancel(options.operationId)\r\n                }).always(function() {\r\n                    that._isRefreshing = false\r\n                });\r\n                dataSource.cancel(that._lastOperationId);\r\n                that._lastOperationId = options.operationId;\r\n                if (that._isRefreshing) {\r\n                    dataSource.cancel(that._lastOperationId)\r\n                }\r\n            }\r\n            this._handleDataLoadingCore(options)\r\n        },\r\n        _handleDataLoadingCore: function(options) {\r\n            var remoteOperations = options.remoteOperations;\r\n            options.loadOptions = {};\r\n            var cachedExtra = options.cachedPagesData.extra;\r\n            var localLoadOptionNames = {\r\n                filter: !remoteOperations.filtering,\r\n                sort: !remoteOperations.sorting,\r\n                group: !remoteOperations.grouping,\r\n                summary: !remoteOperations.summary,\r\n                skip: !remoteOperations.paging,\r\n                take: !remoteOperations.paging,\r\n                requireTotalCount: cachedExtra && \"totalCount\" in cachedExtra || !remoteOperations.paging\r\n            };\r\n            (0, _iterator.each)(options.storeLoadOptions, function(optionName, optionValue) {\r\n                if (localLoadOptionNames[optionName]) {\r\n                    options.loadOptions[optionName] = optionValue;\r\n                    delete options.storeLoadOptions[optionName]\r\n                }\r\n            });\r\n            if (cachedExtra) {\r\n                options.extra = cachedExtra\r\n            }\r\n            options.data = getPageDataFromCache(options) || options.cachedStoreData\r\n        },\r\n        _handleDataLoaded: function(options) {\r\n            var _this3 = this;\r\n            var loadOptions = options.loadOptions;\r\n            var localPaging = options.remoteOperations && !options.remoteOperations.paging;\r\n            var cachedPagesData = options.cachedPagesData;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var needCache = false !== this.option(\"cacheEnabled\") && storeLoadOptions;\r\n            var needPageCache = needCache && !options.isCustomLoading && cachedPagesData && (!localPaging || storeLoadOptions.group) && !this.option(\"legacyRendering\");\r\n            var needPagingCache = needCache && localPaging;\r\n            var needStoreCache = needPagingCache && !options.isCustomLoading;\r\n            if (!loadOptions) {\r\n                this._dataSource.cancel(options.operationId);\r\n                return\r\n            }\r\n            if (options.lastLoadOptions) {\r\n                this._lastLoadOptions = options.lastLoadOptions;\r\n                Object.keys(options.operationTypes).forEach(function(operationType) {\r\n                    _this3._lastOperationTypes[operationType] = _this3._lastOperationTypes[operationType] || options.operationTypes[operationType]\r\n                })\r\n            }\r\n            if (localPaging) {\r\n                options.skip = loadOptions.skip;\r\n                options.take = loadOptions.take;\r\n                delete loadOptions.skip;\r\n                delete loadOptions.take\r\n            }\r\n            if (loadOptions.group) {\r\n                loadOptions.group = options.group || loadOptions.group\r\n            }\r\n            var groupCount = _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group || loadOptions.group).length;\r\n            if (!needPageCache || !getPageDataFromCache(options)) {\r\n                if (needPagingCache && options.cachedPagingData) {\r\n                    options.data = cloneItems(options.cachedPagingData, groupCount)\r\n                } else {\r\n                    if (needStoreCache) {\r\n                        if (!this._cachedStoreData) {\r\n                            this._cachedStoreData = cloneItems(options.data, _uiData_grid2.default.normalizeSortingInfo(storeLoadOptions.group).length)\r\n                        } else {\r\n                            if (options.mergeStoreLoadData) {\r\n                                options.data = this._cachedStoreData = this._cachedStoreData.concat(options.data)\r\n                            }\r\n                        }\r\n                    }\r\n                    new _array_store2.default(options.data).load(loadOptions).done(function(data) {\r\n                        options.data = data;\r\n                        if (needStoreCache) {\r\n                            _this3._cachedPagingData = cloneItems(options.data, groupCount)\r\n                        }\r\n                    }).fail(function(error) {\r\n                        options.data = (new _deferred.Deferred).reject(error)\r\n                    })\r\n                }\r\n                if (loadOptions.requireTotalCount && localPaging) {\r\n                    options.extra = _type2.default.isPlainObject(options.extra) ? options.extra : {};\r\n                    options.extra.totalCount = options.data.length\r\n                }\r\n                if (options.extra && options.extra.totalCount >= 0 && (false === storeLoadOptions.requireTotalCount || false === loadOptions.requireTotalCount)) {\r\n                    options.extra.totalCount = -1\r\n                }\r\n                this._handleDataLoadedCore(options);\r\n                if (needPageCache) {\r\n                    cachedPagesData.extra = cachedPagesData.extra || (0, _extend.extend)({}, options.extra);\r\n                    (0, _deferred.when)(options.data).done(function(data) {\r\n                        setPageDataToCache(options, cloneItems(data, groupCount))\r\n                    })\r\n                }\r\n            }\r\n            options.storeLoadOptions = options.originalStoreLoadOptions\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            if (options.remoteOperations && !options.remoteOperations.paging && Array.isArray(options.data)) {\r\n                if (void 0 !== options.skip) {\r\n                    options.data = options.data.slice(options.skip)\r\n                }\r\n                if (void 0 !== options.take) {\r\n                    options.data = options.data.slice(0, options.take)\r\n                }\r\n            }\r\n        },\r\n        _handleLoadingChanged: function(isLoading) {\r\n            this.loadingChanged.fire(isLoading)\r\n        },\r\n        _handleLoadError: function(error) {\r\n            this.loadError.fire(error);\r\n            this.changed.fire({\r\n                changeType: \"loadError\",\r\n                error: error\r\n            })\r\n        },\r\n        _handleDataChanged: function(args) {\r\n            var that = this;\r\n            var currentTotalCount;\r\n            var dataSource = that._dataSource;\r\n            var isLoading = false;\r\n            var itemsCount = that.itemsCount();\r\n            that._isLastPage = !itemsCount || !that.pageSize() || itemsCount < that.pageSize();\r\n            if (that._isLastPage) {\r\n                that._hasLastPage = true\r\n            }\r\n            if (dataSource.totalCount() >= 0) {\r\n                if (dataSource.pageIndex() >= that.pageCount()) {\r\n                    dataSource.pageIndex(that.pageCount() - 1);\r\n                    that.pageIndex(dataSource.pageIndex());\r\n                    that.resetPagesCache();\r\n                    dataSource.load();\r\n                    isLoading = true\r\n                }\r\n            } else {\r\n                currentTotalCount = dataSource.pageIndex() * that.pageSize() + itemsCount;\r\n                that._currentTotalCount = Math.max(that._currentTotalCount, currentTotalCount);\r\n                if (0 === itemsCount && dataSource.pageIndex() >= that.pageCount()) {\r\n                    dataSource.pageIndex(that.pageCount() - 1);\r\n                    if (\"infinite\" !== that.option(\"scrolling.mode\")) {\r\n                        dataSource.load();\r\n                        isLoading = true\r\n                    }\r\n                }\r\n            }\r\n            if (!isLoading) {\r\n                that._operationTypes = that._lastOperationTypes;\r\n                that._lastOperationTypes = {};\r\n                that.component._optionCache = {};\r\n                that.changed.fire(args);\r\n                that.component._optionCache = void 0\r\n            }\r\n        },\r\n        _scheduleCustomLoadCallbacks: function(deferred) {\r\n            var that = this;\r\n            that._isCustomLoading = true;\r\n            deferred.always(function() {\r\n                that._isCustomLoading = false\r\n            })\r\n        },\r\n        loadingOperationTypes: function() {\r\n            return this._loadingOperationTypes\r\n        },\r\n        operationTypes: function() {\r\n            return this._operationTypes\r\n        },\r\n        lastLoadOptions: function() {\r\n            return this._lastLoadOptions || {}\r\n        },\r\n        isLastPage: function() {\r\n            return this._isLastPage\r\n        },\r\n        totalCount: function() {\r\n            return parseInt(this._currentTotalCount + this._skipCorrection || this._dataSource.totalCount())\r\n        },\r\n        itemsCount: function() {\r\n            return this._dataSource.items().length\r\n        },\r\n        totalItemsCount: function() {\r\n            return this.totalCount()\r\n        },\r\n        pageSize: function() {\r\n            var dataSource = this._dataSource;\r\n            if (!arguments.length && !dataSource.paginate()) {\r\n                return 0\r\n            }\r\n            return dataSource.pageSize.apply(dataSource, arguments)\r\n        },\r\n        pageCount: function() {\r\n            var that = this;\r\n            var count = that.totalItemsCount() - that._skipCorrection;\r\n            var pageSize = that.pageSize();\r\n            if (pageSize && count > 0) {\r\n                return Math.max(1, Math.ceil(count / pageSize))\r\n            }\r\n            return 1\r\n        },\r\n        hasKnownLastPage: function() {\r\n            return this._hasLastPage || this._dataSource.totalCount() >= 0\r\n        },\r\n        loadFromStore: function(loadOptions, store) {\r\n            var dataSource = this._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            if (!dataSource) {\r\n                return\r\n            }\r\n            store = store || dataSource.store();\r\n            store.load(loadOptions).done(function(data, extra) {\r\n                if (data && !Array.isArray(data) && Array.isArray(data.data)) {\r\n                    extra = data;\r\n                    data = data.data\r\n                }\r\n                d.resolve(data, extra)\r\n            }).fail(d.reject);\r\n            return d\r\n        },\r\n        isCustomLoading: function() {\r\n            return !!this._isCustomLoading\r\n        },\r\n        load: function(options) {\r\n            var _this4 = this;\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var d = new _deferred.Deferred;\r\n            if (options) {\r\n                var store = dataSource.store();\r\n                var dataSourceLoadOptions = dataSource.loadOptions();\r\n                var loadResult = {\r\n                    storeLoadOptions: options,\r\n                    isCustomLoading: true\r\n                };\r\n                (0, _iterator.each)(store._customLoadOptions() || [], function(_, optionName) {\r\n                    if (!(optionName in loadResult.storeLoadOptions)) {\r\n                        loadResult.storeLoadOptions[optionName] = dataSourceLoadOptions[optionName]\r\n                    }\r\n                });\r\n                this._isLoadingAll = options.isLoadingAll;\r\n                that._scheduleCustomLoadCallbacks(d);\r\n                dataSource._scheduleLoadCallbacks(d);\r\n                that._handleDataLoading(loadResult);\r\n                executeTask(function() {\r\n                    if (!dataSource.store()) {\r\n                        return d.reject(\"canceled\")\r\n                    }(0, _deferred.when)(loadResult.data || that.loadFromStore(loadResult.storeLoadOptions)).done(function(data, extra) {\r\n                        loadResult.data = data;\r\n                        loadResult.extra = extra || {};\r\n                        that._handleDataLoaded(loadResult);\r\n                        if (options.requireTotalCount && void 0 === loadResult.extra.totalCount) {\r\n                            loadResult.extra.totalCount = store.totalCount(loadResult.storeLoadOptions)\r\n                        }(0, _deferred.when)(loadResult.data, loadResult.extra.totalCount).done(function(data, totalCount) {\r\n                            loadResult.extra.totalCount = totalCount;\r\n                            d.resolve(data, loadResult.extra)\r\n                        }).fail(d.reject)\r\n                    }).fail(d.reject)\r\n                }, that.option(\"loadingTimeout\"));\r\n                return d.fail(function() {\r\n                    that._eventsStrategy.fireEvent(\"loadError\", arguments)\r\n                }).always(function() {\r\n                    _this4._isLoadingAll = false\r\n                }).promise()\r\n            } else {\r\n                return dataSource.load()\r\n            }\r\n        },\r\n        reload: function(full) {\r\n            return full ? this._dataSource.reload() : this._dataSource.load()\r\n        },\r\n        getCachedStoreData: function() {\r\n            return this._cachedStoreData\r\n        }\r\n    }\r\n}());\r\n"]},"metadata":{},"sourceType":"script"}